<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="firebase-common-behavior.html"><link rel="import" href="firebase-auth-script.html"></head><body><dom-module id="firebase-auth"><script>(function(){"use strict";Polymer({is:"firebase-auth",behaviors:[Polymer.FirebaseCommonBehavior],properties:{auth:{type:Object,computed:"_computeAuth(app)",observer:"__authChanged"},provider:{type:String,notify:!0},signedIn:{type:Boolean,computed:"_computeSignedIn(user)",notify:!0},user:{type:Object,readOnly:!0,value:null,notify:!0},statusKnown:{type:Boolean,value:!1,notify:!0,readOnly:!0,reflectToAttribute:!0}},signInAnonymously:function(){if(!this.auth){return Promise.reject("No app configured for firebase-auth!")}return this._handleSignIn(this.auth.signInAnonymously())},signInWithCustomToken:function(token){if(!this.auth){return Promise.reject("No app configured for firebase-auth!")}return this._handleSignIn(this.auth.signInWithCustomToken(token))},signInWithCredential:function(credential){if(!this.auth){return Promise.reject("No app configured for firebase-auth!")}return this._handleSignIn(this.auth.signInWithCredential(credential))},signInWithPopup:function(provider){return this._attemptProviderSignIn(this._normalizeProvider(provider),this.auth.signInWithPopup)},signInWithRedirect:function(provider){return this._attemptProviderSignIn(this._normalizeProvider(provider),this.auth.signInWithRedirect)},signInWithEmailAndPassword:function(email,password){return this._handleSignIn(this.auth.signInWithEmailAndPassword(email,password))},createUserWithEmailAndPassword:function(email,password){return this._handleSignIn(this.auth.createUserWithEmailAndPassword(email,password))},sendPasswordResetEmail:function(email){return this._handleSignIn(this.auth.sendPasswordResetEmail(email))},signOut:function(){if(!this.auth){return Promise.reject("No app configured for auth!")}return this.auth.signOut()},_attemptProviderSignIn:function(provider,method){provider=provider||this._providerFromName(this.provider);if(!provider){return Promise.reject("Must supply a provider for popup sign in.")}if(!this.auth){return Promise.reject("No app configured for firebase-auth!")}return this._handleSignIn(method.call(this.auth,provider))},_providerFromName:function(name){switch(name){case"facebook":return new firebase.auth.FacebookAuthProvider;case"github":return new firebase.auth.GithubAuthProvider;case"google":return new firebase.auth.GoogleAuthProvider;case"twitter":return new firebase.auth.TwitterAuthProvider;default:this.fire("error","Unrecognized firebase-auth provider \""+name+"\"");}},_normalizeProvider:function(provider){if("string"===typeof provider){return this._providerFromName(provider)}return provider},_handleSignIn:function(promise){return promise.catch(function(err){this.fire("error",err);throw err}.bind(this))},_computeSignedIn:function(user){return!!user},_computeAuth:function(){return this.app.auth()},__authChanged:function(auth,oldAuth){this._setStatusKnown(!1);if(oldAuth!==auth&&this._unsubscribe){this._unsubscribe();this._unsubscribe=null}if(this.auth){this._unsubscribe=this.auth.onAuthStateChanged(function(user){this._setUser(user);this._setStatusKnown(!0)}.bind(this),function(err){this.fire("error",err)}.bind(this))}}})})();</script></dom-module></body></html>