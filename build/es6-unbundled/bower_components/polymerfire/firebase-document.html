<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="firebase-database-behavior.html"><script>"use strict";Polymer({is:"firebase-document",behaviors:[Polymer.FirebaseDatabaseBehavior],attached:function(){this.__needSetData=!0;this.__refChanged(this.ref,this.ref)},detached:function(){if(this.ref){this.ref.off("value",this.__onFirebaseValue,this)}},get isNew(){return this.disabled||!this.__pathReady(this.path)},get zeroValue(){return{}},saveValue:function(parentPath,key){return new Promise(function(resolve,reject){var path=null;if(!this.app){reject(new Error("No app configured!"))}if(key){path=parentPath+"/"+key;resolve(this._setFirebaseValue(path,this.data))}else{path=firebase.database(this.app).ref(parentPath).push(this.data,function(error){if(error){reject(error);return}resolve()}).path.toString()}this.path=path}.bind(this))},reset:function(){this.path=null;return Promise.resolve()},destroy:function(){return this._setFirebaseValue(this.path,null).then(function(){return this.reset()}.bind(this))},memoryPathToStoragePath:function(path){var storagePath=this.path;if("data"!==path){storagePath+=path.replace(/^data\.?/,"/").split(".").join("/")}return storagePath},storagePathToMemoryPath:function(storagePath){var path="data";storagePath=storagePath.replace(this.path,"").split("/").join(".");if(storagePath){path+="."+storagePath}return path},getStoredValue:function(path){return new Promise(function(resolve){this.db.ref(path).once("value",function(snapshot){var value=snapshot.val();if(null==value){resolve(this.zeroValue)}resolve(value)},this.__onError,this)}.bind(this))},setStoredValue:function(path,value){return this._setFirebaseValue(path,value)},__refChanged:function(ref,oldRef){if(oldRef){oldRef.off("value",this.__onFirebaseValue,this)}if(ref){ref.on("value",this.__onFirebaseValue,this.__onError,this)}},__onFirebaseValue:function(snapshot){var value=snapshot.val();if(null==value){value=this.zeroValue;this.__needSetData=!0}if(!this.isNew){this.async(function(){this.syncToMemory(function(){this._log("Updating data from Firebase value:",value);if(this.__needSetData||!this.data||"object"!==typeof value||Object.keys(value).length<Object.keys(this.data).length){this.__needSetData=!1;return this.set("data",value)}for(var prop in value){if(value[prop]!==this.data[prop]){this.set(["data",prop],value[prop])}}})})}}});</script></head><body></body></html>